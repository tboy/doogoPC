<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title></title>
		<link rel="stylesheet" href="../css/bootstrap.css">
		<link rel="stylesheet" href="../css/common.css">
		<link rel="stylesheet" href="../css/iframe.css">
		<link rel="stylesheet" href="../css/jquery.pagination.css">
		<link rel="stylesheet" href="../css/jquery-ui.css">
		<link rel="stylesheet" href="../css/reset.css">
		<link rel="stylesheet" href="../css/style.css">
		<link rel="stylesheet" href="../css/styles.css">
		<link rel="stylesheet" href="../css/swiper.css">
		<link rel="stylesheet" href="../css/myTaskCom.css">
		<link rel="stylesheet" href="../css/myTask3.css">


		<link rel="stylesheet" href="../css/element-ui/index.css">


		<link rel="stylesheet" href="../js/page/easyhelper.min.css">
		<link rel="stylesheet" href="../css/chosen.css">
		<script src="../js/page/jquery-3.3.1.min.js"></script>
		<script src="../css/element-ui/vue.js"></script>
		<script src="../css/element-ui/index.js"></script>

		<script src="../js/chosen.jquery.js"></script>
		<script src="../js/echarts.min.js"></script>
		<script src="../js/chartDemo.js"></script>

		<script src="../js/page/jquery.transit.min.js"></script>
		<script src="../js/page/es6-shim.min.js"></script>
		<script src="../js/page/easyhelper.min.js"></script>
		<script src="../js/page/jquery-3.3.1.min.js"></script>
		<script src="../css/element-ui/vue.js"></script>
		<!-- 引入样式 -->
		<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
		<!-- 引入组件库 -->
		<script src="https://unpkg.com/element-ui/lib/index.js"></script>
	</head>
	<body style="display:none;">
		<div class="myContent" id="cnt" v-cloak>
			<div style="height: 55px;padding-top: 10px;">
				<el-button class="btn2" type="primary" size="small" style="margin-left:0;">添加成员</el-button>
				<el-button @click="showXls = true;" class="btn2" type="primary" size="small">批量导入</el-button>
				<el-button @click="showAdd = true;" class="btn2" type="primary" size="small">设置所在部门</el-button>
				<el-button @click="delHandle" class="btn2" type="primary" size="small">删除</el-button>
				<el-button @click="showWX = true;" class="btn2" type="primary" style="background: #ff7326;" size="small">微信邀请加入</el-button>
			</div>

			<el-table :data="tableData" :header-cell-style="{background:'#f1f1f1'}" style="width: 100%;margin-bottom: 20px;"
			 row-key="id" default-expand-all @selection-change="handleSelectionChange">
				<el-table-column type="selection" width="55">
				</el-table-column>
				<el-table-column prop="name" label="姓名">
				</el-table-column>
				<el-table-column prop="phone" label="手机">
				</el-table-column>
				<el-table-column label="部门">
					<template slot-scope="scope">
						<template v-for="dept in scope.row.depts">
							<div>
								{{dept.name}}
							</div>
						</template>
					</template>
				</el-table-column>
				<el-table-column prop="position" label="职务">
				</el-table-column>
				<el-table-column prop="email" label="邮箱">
				</el-table-column>
				<el-table-column label="操作">
					<template slot-scope="scope">
						<el-button type="text" size="small" style="color:#007398;">编辑</el-button>


					</template>
				</el-table-column>

			</el-table>

			<div id="page" style="margin:10px 0px;margin-bottom: 50px;"></div>

			<el-dialog title="批量导入" :visible.sync="showXls" width="500px" center>
				<span>
					<span style="display: block; margin: auto;width: 74%;">请下载通讯录模版，按格式修改后导入
						<el-button class='btn1' @click="downXls" type="text" style="float: right; margin-top: -23px;" size="small">下载模板</el-button>
					</span>
					<p v-if="fileName == ''" style="display: block;margin: auto;width: 100%;height: 16px;margin-top: 37px;padding: 33px 0px;background: #f1f1f1;">
						<span style="margin-left: 59px;">文件中成员将被导入至公司主体下</span>
						<el-button style="margin-left:28px;" class="btn2" @click="selXls" type="primary" size="small">上传文件</el-button>
					</p>
					<p v-if="fileName != ''" style="display: block;margin: auto;width: 100%;height: 16px;margin-top: 37px;padding: 33px 0px;background: #f1f1f1;">
						<span style="margin-left: 59px;">{{fileName}}
							<el-button @click="selXls" type="text" style="color: #007398;" size="small">重新上传</el-button>
						</span>
						<el-button class="btn2" @click="uploadXls" style="float: right;margin-right: 59px;width: 90px;" type="primary"
						 size="small">导入</el-button>
					</p>
				</span>

			</el-dialog>
			<el-dialog title="微信邀请" :visible.sync="showWX" width="310px" center>
				<span>
					<span style="display: block;text-align:center;">分享二维码通知加入</span>
					<img src="../images/wx.png" />
					<el-button @click="copy" type="text" size="small" style="margin: auto; display: block;">复制邀请链接</el-button>
					<el-button v-if="isCopy" type="text" size="small" style="margin: auto; display: block;background:#38b52e;color:white;padding: 2px 2px;border-radius: 0;">复制成功</el-button>
				</span>
				<span slot="footer" class="dialog-footer">
					<el-button @click="showWX = false">关 闭</el-button>

				</span>
			</el-dialog>

			<el-dialog title="成员删除" :visible.sync="showDel" width="30%" center>
				<span>
					<span style="display: block;text-align:center;">删除后，成员的记录将完全被清除。</span>
				</span>
				<span slot="footer" class="dialog-footer">
					<el-button class="btn3" @click="showDel = false;" type="text" size="small">取消</el-button>
					<el-button @click="delUsers" type="text" class="btn2" size="small">确定</el-button>
				</span>
			</el-dialog>

		</div>
		<textarea style="display:none;" cols="20" rows="10" id="biao1">www.baidu.com</textarea>

		<input style="display:none;" id="xls" onchange="getFileName();" type="file" accept=".xls" />
	</body>
</html>
<script>
	var app;
	$(function() {
		initDateUI();
		setTimeout(function(){
			document.body.style.display='block';
			Helper.ui.page("#page", {
				total: 30, //数据总量
				pageSize: 8, //每页的数据量
				currentPage: 1, //默认处于哪一页
				showTotal: false, //是否在分页按钮左侧显示数据总量
				showTo: false, //是否在分页按钮右侧显示直接跳转至某一页
				change: function(i) {
					console.log("第几页" + i);
					//自己后台拉数据 app.$data.tbs
					app.$data.currentPage = i;
					app.queryData();
				}
			});
		},200);
		
	});

	function initDateUI() {
		var obj = {};
		app = new Vue({
			el: "#cnt",
			data: function() {
				obj.currentPage = 1;
				obj.showXls = false;
				obj.showWX = false;
				obj.showDel = false;
				obj.isCopy = false;
				obj.selItem = [];
				obj.fileName = '';
				obj.tableData = [{
						id: 1,
						name: '小灿',
						phone: '123213123342',
						depts: [{
							id: 1,
							name: '东区门店'
						}, {
							id: 2,
							name: '西区门店'
						}],
						position: '皇帝',
						email: "ggg@qq.com"
					},
					{
						id: 2,
						name: '二狗',
						phone: '123213123342',
						depts: [{
							id: 2,
							name: '西区门店'
						}],
						position: '皇帝',
						email: "ggg@qq.com"
					}
				];
				return obj;
			},

			methods: {
				handleSelectionChange(val) {
					this.$data.selItem = val;
				},
				delHandle() {
					this.$data.selItem.length > 0 ? this.$data.showDel = true : alert('请勾选用户');
				},
				delUsers() {
					//this.$data.selItem;
					this.$data.selItem.map(item2 => {
						this.$data.tableData.map((item, idx) => {

							if (item.id == item2.id) {
								this.$data.tableData.splice(idx, 1);
							}
						})
					})
					this.$data.selItem = null;
					this.$data.showDel = false;
				},
				copy() {
					var Url2 = document.getElementById("biao1");
					Url2.select(); // 选择对象
					document.execCommand("Copy"); // 执行浏览器复制命令
					this.$data.isCopy = true;
				},
				selXls() {
					$("#xls").trigger("click");
				},
				downXls() {
					window.open("http://www.baidu.com", "_blank");
				},
				uploadXls() {
					let that = this;
					var formData = new FormData();
					var name = $("#xls").val();
					formData.append('file', $("#xls")[0].files[0]);
					// 此处可传入多个参数
					formData.append('name', name);
					$.ajax({
						url: '/collar/import',
						type: 'post',
						async: false,
						data: formData,
						processData: false, // 告诉jQuery不要去处理发送的数据
						contentType: false, // 告诉jQuery不要去设置Content-Type请求头
						beforeSend: function() { //过程...
							console.log('正在进行，请稍候')
						},
						success: function(res) {
							alert("导入成功");
							that.$data.showXls = false;
						},
						error: function() {
							alert("导入失败");
							that.$data.showXls = false;
							//console.log('导入失败')
						}
					})

				},
				queryData() {

				}
			}
		})

	}

	function arrDel(arr, item) {
		arr.map((temp, idx) => {
			if (temp.id == item.id) {
				arr.splice(idx, 1);
				return;
			}
			if (temp.children) {
				arrDel(temp.children, item);
			}
		})
	}


	function getFileName() {
		var obj = document.getElementById("xls");
		app.$data.fileName = obj.files[0].name;
	}
</script>
<style>
	[v-cloak] {
		display: none;
	}

	.el-dialog__title {
		line-height: 24px;
		font-size: 14px;
		color: #666;
		float: left;
	}

	.el-dialog__header {
		height: 16px;
		padding: 12px 20px 10px;
	}

	.el-dialog__body {
		color: #666;
		font-size: 14px;
		word-break: break-all;
		border-top: 1px solid #f1f1f1;
	}

	.btn1 {
		color: #808080;
		background: #f1f1f1;
		font-size: 14px;
		padding: 6px 16px;
		margin-left: 14px;
	}

	.btn2 {
		color: #fff;
		background: #007398;
		font-size: 14px;
		padding: 6px 16px;
		margin-left: 14px;
		border: 0;
	}

	.btn3 {
		border: 1px solid #ccc;
		color: black;
		padding: 6px 19px;
	}

	.btn3:hover {
		border: 1px solid #ccc;

	}

	.btn2:hover {
		background: #018fbd;
	}

	.el-table th>.cell {
		display: inline-block;
		-webkit-box-sizing: border-box;
		box-sizing: border-box;
		position: relative;
		vertical-align: middle;
		padding-left: 10px;
		padding-right: 10px;
		width: 100%;
		font-weight: 100;
		font-size: 14px;
	}

	.el-table .cell {
		-webkit-box-sizing: border-box;
		box-sizing: border-box;
		overflow: hidden;
		text-overflow: ellipsis;
		white-space: normal;
		word-break: break-all;
		line-height: 23px;
		padding-right: 10px;
		font-size: 14px;
		color: #666;
		font-weight: 100;
	}

	.el-table td,
	.el-table th {
		padding: 3px 0;
		min-width: 0;
		-webkit-box-sizing: border-box;
		box-sizing: border-box;
		text-overflow: ellipsis;
		vertical-align: middle;
		position: relative;
		text-align: left;
	}

	.el-dialog__headerbtn {
		top: 5px !important;
	}

	.helper-page-wrapper i.active {
		color: #fff;
		background: #007398;
		cursor: default;
	}
</style>
